<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.kakeiboApp.repository.KakeiboMapper">

<!--全ての家計簿を獲得-->
<select id="getAll" resultType="com.example.kakeiboApp.DTO.KakeiboDTO">
	select
		K.id,
		C.category,
		K.trade_date as tradeDate,
		K.amount,
		K.homeru,
		K.memo,
		K.created_at as createdAt,
		K.updated_at as updatedAt
	from kakeibo K left join category C
	on K.category_id = C.id
</select>

<!--今月の収入を獲得-->
<select id="getMonthlyTotalIncome">
	select 
		coalesce(sum(K.amount) , 0)
	from 
		Kakeibo K 
		left join category C				
		on K.category_id = C.id				
	where				
		C.in_out = 'IN'
	and	
		K.trade_date between
			make_date(#{year},#{month}, #{day}) - interval '1 month' 
			+ interval '1 day'
		and
			make_date(#{year},#{month}, #{day})
</select>

<!-- 今月の支出を獲得 -->
<select id="getMonthlyTotalOutgo">
	select 
		coalesce(sum(K.amount) , 0)
	from 
		Kakeibo K 
		left join category C				
		on K.category_id = C.id				
	where				
		C.in_out = 'OUT'
	and	
		K.trade_date between
			make_date(#{year},#{month}, #{day}) - interval '1 month' 
			+ interval '1 day'
		and
			make_date(#{year},#{month}, #{day})
</select>
</mapper>